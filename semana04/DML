1.CREACION DE TABLAS

QUERY :
-- TABLA EMPLEADOS
CREATE TABLE EMPLEADOS (
DNI NUMBER(8) PRIMARY KEY,
NOMBRE VARCHAR2(10) NOT NULL,
APELLIDO1 VARCHAR2(15) NOT NULL,
APELLIDO2 VARCHAR2(15),
DIRECC1 VARCHAR2(25),
DIRECC2 VARCHAR2(20),
CIUDAD VARCHAR2(20),
PROVINCIA VARCHAR2(20),
COD_POSTAL VARCHAR2(5),

SEXO VARCHAR2(1) CHECK (SEXO IN ('H','M')),
FECHA_NAC DATE
);

-- TABLA DEPARTAMENTOS
CREATE TABLE DEPARTAMENTOS (
DPTO_COD NUMBER(5) PRIMARY KEY,
NOMBRE_DPTO VARCHAR2(30) UNIQUE NOT NULL,
DPTO_PADRE NUMBER(5),
PRESUPUESTO NUMBER NOT NULL,
PRES_ACTUAL NUMBER
);

-- TABLA TRABAJOS
CREATE TABLE TRABAJOS (
TRABAJO_COD NUMBER(5) PRIMARY KEY,
NOMBRE_TRAB VARCHAR2(20) UNIQUE NOT NULL,
SALARIO_MIN NUMBER(2) NOT NULL,
SALARIO_MAX NUMBER(2) NOT NULL
);

-- TABLA UNIVERSIDADES
CREATE TABLE UNIVERSIDADES (
UNIV_COD NUMBER(5) PRIMARY KEY,
NOMBRE_UNIV VARCHAR2(25) NOT NULL,
CIUDAD VARCHAR2(20),
MUNICIPIO VARCHAR2(20),
COD_POSTAL VARCHAR2(5)
);

-- TABLA ESTUDIOS
CREATE TABLE ESTUDIOS (
EMPLEADO_DNI NUMBER(8),
UNIVERSIDAD NUMBER(5),
AÑO NUMBER,
GRADO VARCHAR2(3),
ESPECIALIDAD VARCHAR2(20),
PRIMARY KEY (EMPLEADO_DNI, UNIVERSIDAD),
FOREIGN KEY (EMPLEADO_DNI) REFERENCES EMPLEADOS(DNI),
FOREIGN KEY (UNIVERSIDAD) REFERENCES UNIVERSIDADES(UNIV_COD)
);

-- TABLA HISTORIAL_LABORAL
CREATE TABLE HISTORIAL_LABORAL (
EMPLEADO_DNI NUMBER(8),
TRABAJO_COD NUMBER(5),
FECHA_INICIO DATE,
FECHA_FIN DATE,
DPTO_COD NUMBER(5),
SUPERVISOR_DNI NUMBER(8),
PRIMARY KEY (EMPLEADO_DNI, TRABAJO_COD, FECHA_INICIO),
FOREIGN KEY (EMPLEADO_DNI) REFERENCES EMPLEADOS(DNI),
FOREIGN KEY (TRABAJO_COD) REFERENCES TRABAJOS(TRABAJO_COD),
FOREIGN KEY (DPTO_COD) REFERENCES DEPARTAMENTOS(DPTO_COD),
FOREIGN KEY (SUPERVISOR_DNI) REFERENCES EMPLEADOS(DNI)
);

-- TABLA HISTORIAL_SALARIAL

CREATE TABLE HISTORIAL_SALARIAL (
EMPLEADO_DNI NUMBER(8),
SALARIO NUMBER NOT NULL,
FECHA_COMIENZO DATE,
FECHA_FIN DATE,
PRIMARY KEY (EMPLEADO_DNI, FECHA_COMIENZO),
FOREIGN KEY (EMPLEADO_DNI) REFERENCES EMPLEADOS(DNI)
);

2.INSERCIONES PEDIDAS

-- Insertar empleados
INSERT INTO EMPLEADOS (NOMBRE, APELLIDO1, APELLIDO2, DNI, SEXO)
VALUES ('Sergio', 'Palma', 'Entrena', 111222, 'H');

INSERT INTO EMPLEADOS (NOMBRE, APELLIDO1, APELLIDO2, DNI, SEXO)
VALUES ('Lucia', 'Ortega', 'Plus', 222333, 'M');

-- Insertar historial laboral
INSERT INTO HISTORIAL_LABORAL (EMPLEADO_DNI, FECHA_INICIO, SUPERVISOR_DNI)
VALUES (111222, TO_DATE('16/06/1996','DD/MM/YYYY'), 222333);

3.ALTERACIONES DE TABLAS

-- Agregar teléfono y celular
ALTER TABLE EMPLEADOS ADD TELEFONO VARCHAR2(15);
ALTER TABLE EMPLEADOS ADD CELULAR VARCHAR2(15);

-- Restricción: si hay CIUDAD debe haber COD_POSTAL
ALTER TABLE EMPLEADOS ADD CONSTRAINT chk_ciudad_postal
CHECK ( (CIUDAD IS NULL AND COD_POSTAL IS NULL) OR (CIUDAD IS NOT NULL AND
COD_POSTAL IS NOT NULL) );

-- Valoración por defecto 5
ALTER TABLE EMPLEADOS ADD VALORACION NUMBER(2) DEFAULT 5 CHECK
(VALORACION BETWEEN 1 AND 10);

-- Quitar restricción NOT NULL de NOMBRE
ALTER TABLE EMPLEADOS MODIFY NOMBRE NULL;

-- Cambiar longitud de DIRECC1
ALTER TABLE EMPLEADOS MODIFY DIRECC1 VARCHAR2(40);

3.VISTAS

CODIGO:
-- Vista empleados de Málaga
CREATE VIEW NOMBRE_EMPLEADOS AS
SELECT NOMBRE || ' ' || APELLIDO1 || ' ' || APELLIDO2 AS NOMBRE_COMPLETO
FROM EMPLEADOS
WHERE CIUDAD = 'Málaga';

-- Vista con edad
CREATE VIEW INFORMACION_EMPLEADOS AS
SELECT NOMBRE || ' ' || APELLIDO1 || ' ' || APELLIDO2 AS NOMBRE_COMPLETO,
TRUNC(MONTHS_BETWEEN(SYSDATE, FECHA_NAC)/12) AS EDAD

FROM EMPLEADOS;

-- Vista con salario actual
CREATE VIEW INFORMACION_ACTUAL AS
SELECT E.NOMBRE || ' ' || E.APELLIDO1 || ' ' || E.APELLIDO2 AS NOMBRE_COMPLETO,
TRUNC(MONTHS_BETWEEN(SYSDATE, E.FECHA_NAC)/12) AS EDAD,
HS.SALARIO
FROM EMPLEADOS E
JOIN HISTORIAL_SALARIAL HS
ON E.DNI = HS.EMPLEADO_DNI
WHERE HS.FECHA_FIN IS NULL;
